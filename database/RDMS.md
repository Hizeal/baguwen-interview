# 关系型数据库

## 主键、超键、候选键、外键是什么

- **超键**：在关系中能唯一标识**元组的属性集**称为关系模式的超键
- **候选键**：不含有**多余属性的超键**称为候选键。也就是在候选键中，若再删除属性，就不是键了
- **主键**：**用户选作元组标识的一个候选键程序主键**
- **外键**：如果关系模式**R中属性K是其它模式的主键**，那么**k在模式R中称为外键**
- 主键与索引的区别
  - 主键一定是唯一性索引，唯一性索引并不一定是主键
  - 主键可以唯一的标识表中的某一行的属性或者属性组
  - 主键列不允许为空，但是索引可以为空
## RDMS与非关系型数据库区别
- 关系型数据库
  - 采用了关系模型来组织数据
  - 保持数据的一致性
  - 数据更新的开销比较小
  - 支持复杂查询
- 非关系型数据库
  - 不需要经过SQL层的解析，读写效率高
  - 基于键值对，数据的扩展性很好
  - 支持多种类型数据的存储
  - 适用场景：
    - 数据量大、高可用、日志系统等

## RDMS中SQL执行过程
- 连接器
- 查询缓存，此前是否执行过语句
- SQL引擎
  - Paser：词法分析与语法分析生成语法树，并对语法树进行合法性检验
  - Optimizer：根据生成的语法树，按照规则或代价产生执行计划树
  - Executor：根据计划树执行，常用模型为**火山模型**
- 存储引擎
  - Buffer Pool：缓存数据，减少I/O开销
  - Page：数据存储基本单位
  - B+ Tree：InnoDB常用索引结构
- 事务引擎
  - ACID

## RDMS企业实践的问题
### 请求流量非常大
- 问题
  - 单节点数据容量有限
  - 单节点写容易成为瓶颈

- 解决方法：Sharding
  - 业务数据水平拆分：数据拆分并存储在多台服务器
  - 代理层分片路由：增加服务器数量

### 流量突增
- 问题
  - 活动期间流量上涨
  - 集群性能不满足要求

- 解决方法1：扩容
  - 扩容DB物理节点数量
- 解决方法2：代理连接池
  - 业务侧预热连接池
  - 代理侧预热连接池
  - 代理侧支持连接队列

### 可靠性与稳定性
- 问题
  - DB所在机器宕机

- 解决方法：HA管理
  - ha服务监管，切换宕机节点
  - 代理支持配置热加载
  - 代理自动屏蔽宕机读节点