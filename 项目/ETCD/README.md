ETCD是一个分布式的KV存储数据库，通过raft算法保持数据的一致性。

通常，我们会把etcd作为分布式系统的数据共享，或者是服务发现，服务注册等。

## 通信方式
采用gRPC作为底层通信协议，而gRPC实现多路复用，一对多

protobuf作为消息传递数据格式

问题1：为什么不用json？

回答：
1. 多余内存开销。对于int类型，内存只占2字节，转为json需要5字节
2. 重复传输字段，同样的key，work，只是因为值不同，就要传输两次work这个key值

问题2：为什么采用gRPC

回答：
1. 性能： protobuf序列化字段，负载小
2. 协议：转为HTTP/2 设计，比普通的HTTP紧凑高效，单个TCP可复用多个HTTP/2 调用
3. 代码生成：.proto文件自动生成，并且端到端生成消息和客户端代码
4. 严格规范：避免多平台的情况下出现分歧，各个平台实现一致。
5. 流式处理：支持一元，服务到客户端，客户到服务端，双向流式传输
6. 超时处理支持：支持rpc内部的timeout，并且可以取消timeout的服务
## 作用
1. 服务发现

2. 服务注册

3. 数据共享

## ETCD查询步骤
1. 寻找指定的key值
2. 获取全部generation版本号
3. 根据查询的generation从存储中找到具体的Value值
4. 输出Value


etcd将数据存放在一个持久化的B+树
etcd会维护一个字段序的B树索引，是为了加速针对key的范围扫描
每个B树索引项中，都存储了一个key值，这也是为了快速定位指定的key或者进行范围扫描
etcd的每个key有多个版本，在每个revision的tree里，有多个对应的keys