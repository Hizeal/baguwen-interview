# 微服务概览

> 微服务细碎的问题就放在这里讨论

微服务的面试题，大体上可以分成：
1. 微服务本身的面试题。包括微服务的概念，为什么要微服务之类的；
2. 微服务治理的面试题。主要就是服务注册与发现，熔断限流之类的；
3. 微服务架构的面试题。微服务有什么部分，每个部分有什么用处，以及怎么设计；
4. 微服务选型的面试题。包括选择微服务框架，以及选择微服务依赖的第三方中间件的问题；

## 面试题目
### 微服务和 RESTful 的区别

微服务是一种架构，而 RESTful API 是符合**REST**设计风格的 Web API。所以从这个角度来说，这两者根本不具备可比性。那么为什么面试官要问这个问题呢？大概率是他们公司内部有并存的微服务应用，和 RESTful 应用。

我们先来分析 RESTful，它是一种遵守了**REST**设计风格的 Web API，显然也有不遵守 REST 的。这部分我们一般就是简单描述为 Web 服务。

REST设计风格：互联网应用程序的API设计理念：URL定位资源，用HTTP描述操作


而微服务，一般是指以 RPC 为通信，结合了整个微服务治理的架构模式。实际上，微服务作为一种架构模式，其落地的选择是有很多的，除了这里说的 RPC，还有一种很重要的实现手段就是基于 Web API 的实现方式。

我们可以总结来说，微服务落地，最基本的通信的角度来说，可以是 RPC，也可以是 HTTP。而在 HTTP 之下，有一个子分类就是 RESTful。因此，微服务和 RESTful 的区别，核心就是：
1. 微服务是架构模式；
2. RESTful 是指符合 REST 规范的 Web API；
3. 微服务可以用 RESTful 来实现；

这里就基本上讨论清楚了，不过我们还可以刷一个亮点：RPC 本身也是可以用 RESTful 来实现的。于是我们可以加上第四点：有些微服务虽然是基于 RPC 来构建的，但是 RPC 本身又可以是用 RESTful 来实现的。

沿着这个思路：
1. 微服务用什么实现？RESTful 或者 RPC 都可以；
2. RPC 用什么实现？直接基于 TCP 或者基于 HTTP 都可以。

答案：
1. 微服务是架构模式；
2. RESTful 是指符合 REST 规范的 Web API；
3. 微服务可以用 RESTful 来实现；
4. （亮点）微服务的另外一种实现，是利用 RPC 来实现；而 RPC 可以直接基于 TCP 来实现，也可以基于 HTTP 来实现，所以也可以用 RESTful 来实现；（这里可能会引起面试官的兴趣，就是问你 RPC 有哪些实现思路）

（最后总结）微服务和 RESTful 总体来说是两种维度的东西。

（这里还有一个可能，就是面试官问你，RPC 和 RESTful 的区别，以为第四点我们聊到了微服务可以是 RPC 也可以是 RESTful）

### RPC 和 RESTful 的区别

分析：RPC 和 RESTful 的区别，前面的问题**微服务和 RESTful 的区别**我们已经提到了。 RPC 名字叫做远程过程调用，是一种远程通信协议。但凡是协议，就会有落地。那么 RPC 的落地就很百花争鸣了，不过主流就是两个流派：基于 HTTP 的和基于 TCP 的。前者的代表是 gRPC，后者的代表是 Dubbo。基于 HTTP 的，如果要是它的 API 设计也符合 REST 设计风格，那么就可以说，它是基于 RESTful 的。

后面我们可以稍微聊一下这两种实现方式的优劣对比，作为一个亮点。

答案：RPC 是远程通信协议，它的实现可以是基于 HTTP 的，也可以是基于 TCP 的。而 RESTful 是符合 REST 设计风格的 Web API。因此，如果一个 RPC 是基于 HTTP 的，并且 HTTP 的 API 设计是符合 REST 设计风格的，那么就可以说这个 RPC 是基于 RESTful 的。

它们也是两个不同维度的东西。一般来说，基于 TCP 的 RPC 实现更加复杂，但是可以从 TCP 层面上优化，因此性能会更好。而基于 HTTP 的则是实现非常简单，目前，基于 HTTP2 协议实现的 RPC 在性能上也很优秀，对于大部分应用来说，并不会触及它的性能上限（这里面是一个很大的误区，有很多人实际中，根本不考虑自己的实际情况，就使劲朝着高性能的角度去选型，其实大多数时候，我们都是和复杂度本身做斗争，而不是和性能作斗争）。

### RPC实现思路
  - 机器之间的通信传输协议
  - 报文的编码与解码，是json、xml或是protobuf编码
  - 连接超时
  - 是否支持异步请求和并发
  - 服务注册中心和服务动态添加、删除（**心跳机制**确保服务处于可用状态，引出zookeeper心跳）
  - 负载均衡：随机选择、轮询、加权轮询、一致性哈希

### 微服务划分的粒度该如何确定？
- 各服务有清晰的责任及边界，一个服务对应一块业务，服务间多为单向依赖
- 新增或变更业务上有很明确的服务对应
- 技术上服务设定的核心要关注对性能的影响、是否稳定及架构是否简洁，是否要引入额外的中间件等

### 既然有了模块化，为什么还要微服务？

- 团队能够独立地工作与扩张。
- 微服务小巧、专一，降低了复杂度。
- 服务可以在不会影响全局的情况下内部进行更改或者替换。

### 微服务和 SOA 对比

SOA：面向服务架构
- 将进程按照不同的功能单元进行抽象，拆分为『服务』
- SOA 还为服务之间的通信定义了标准，保证各个服务之间通讯体验的一致性
  - 优点
        各服务的职责更清晰
        爆照半径可控
        
  - 缺点
        ESB (企业服务总线) 往往需要一整套解决方案


微服务：
- SOA分布式演进的分支的最终形态
  - 优点
        兼具 SOA 解决的问题
        服务间的通信更敏捷、灵活

  - 缺点
        运维成本


二者对比
1. 服务粒度
   1. SOA粗，微服务更细

2. 服务通信
   1. SOA采用 ESB 作为服务间通信的关键组件，负责服务定义、服务路由、消息转换、消息传递，一般情况下都是重量级的实现
   2. 微服务则使用统一的协议和格式，例如：HTTP RESTful 协议、TCP RPC 协议，不需要 ESB 这样的重量级实现

3. 服务交付
   1. SOA 更加适合于庞大、复杂、异构的企业级系统


